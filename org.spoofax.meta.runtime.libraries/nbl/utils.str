module nbl/utils

imports
	
	task/core

rules 
	
	match(m|val) = where (!val; m)
	
	vdebug(s) = where(verbose < debug(s) + id)
	verbose   = fail

  force-origins(s) =
    ![<id>]; all(s); ?[<id>]

	is-completion-name = ?"completion123"
  fix-completion-name = is-completion-name; !""

  add-annotation(|a):
    t{a*} -> t{a, a*}

  remove-annotations(s):
    t{a*} -> t{a'*}
    where
      a'* := <remove-all(s)> a*
  
  measure-time(s, log) =
    where(before := <times>);
    s;
    where(after := <times>; !(after, before); diff-times; times-to-seconds; Fst; log)
  
  measure-time(s, log | name) = 
    measure-time(s, record-time-native(|name); log)
    
  external record-time-native(|name)
  	
 	try-make-list =
		switch id
			case is-list: id
			case ?Dependency(_): id
			otherwise: ![<id>]
		end	
		
	try-remove-list =
		switch id
			case is-list : Hd
			otherwise    : id
		end	
